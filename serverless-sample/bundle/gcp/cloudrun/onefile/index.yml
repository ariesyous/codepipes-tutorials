  
schema_version: v0.0.1

application:
  name: cloud-run
  description: Sample cloud run application
  appConfig:
    version: 1
  artifacts:
    - name: Cloud_Run_Sample_Container_Image
      id: 0187DD95-2315-44E1-9209-FA0C53F9B45A
      containerImage:
        provider: custom_registry
        repo: gcr.io/vanguard-test-deploy/cloudrun-server
        reference: latest
  creds:
    - credsType_gcp
    - credsType_github

deployment:
  name: CloudRunDeployment
  description: Service Deployment
  deploymentConfig:
    artifact:
      id: 0187DD95-2315-44E1-9209-FA0C53F9B45A
    provisioner: gcp
    template:
      moduleRefId: gcp:cloud-run@1
      inputs:
        region:  "us-central1"
        allowUnauthenticated:  true
    env:
      BUCKET: "${terraform.gcp_bucket.value}"
      PROJECT_ID: "vanguard-test-deploy"
      IMAGE_PATH: "test.gif"

environment:
  name: production
  description: Cloud run sample app infra on GCP
  revision:
    driver: github
    repo: https://github.com/cldcvr/codepipes-tutorials
    dir: serverless-sample/infra/gcp
    identifier: cloudrun-demo
    type: branch
  variables:
    - type: tf_var
      key: GOOGLE_PROJECT
      value: "vanguard-test-deploy"
  policySet: Unrestricted
  creds:
    - credsType_gcp
    - credsType_github
